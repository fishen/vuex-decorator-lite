{"version":3,"sources":["webpack://vuex-decorator-lite/./src/constants.ts","webpack://vuex-decorator-lite/./src/index.ts","webpack://vuex-decorator-lite/./src/model.ts","webpack://vuex-decorator-lite/./src/module.ts","webpack://vuex-decorator-lite/./src/store.ts","webpack://vuex-decorator-lite/external \"reflect-metadata\"","webpack://vuex-decorator-lite/external \"vuex\"","webpack://vuex-decorator-lite/webpack/bootstrap","webpack://vuex-decorator-lite/webpack/startup"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["export const DESIGN_PARAM_TYPES = \"design:paramtypes\";\r\nexport const DESIGN_TYPE = \"design:type\";\r\nexport const DESIGN_RETURN_TYPE = \"design:returntype\";","import \"reflect-metadata\";\r\nexport { VuexModel, VuexModelOptions } from './model';\r\nexport { Module, ModuleOptions } from './module';\r\nexport { Newable } from './type';","import { Store } from \"./store\";\r\nimport Vuex, { Module, Plugin } from 'vuex';\r\nimport { Newable } from './type';\r\nimport { ModuleOptions } from './module';\r\n\r\nexport interface VuexModelOptions<P = any> {\r\n    plugins?: Plugin<P>[];\r\n    strict?: boolean;\r\n    devtools?: boolean;\r\n}\r\n\r\nexport class VuexModel<C extends Newable, S = any> {\r\n\r\n    public readonly instance: InstanceType<C>;\r\n    public readonly module: Module<S, any>\r\n\r\n    constructor(type: C, options?: ModuleOptions) {\r\n        this.instance = Store.construct(type);\r\n        this.module = Store.createStore(this.instance as any, [], false, options?.reusable);\r\n    }\r\n    install(vue: { prototype: any }, options?: { name: string }) {\r\n        const { name } = Object.assign({ name: 'store' }, options);\r\n        Object.defineProperty(vue.prototype, name, { get: () => this.instance });\r\n    }\r\n    createStore(options?: VuexModelOptions) {\r\n        const module = Object.assign({}, this.module);\r\n        const value = new Vuex.Store<S>(Object.assign({}, options, module))\r\n        Object.defineProperty(this.instance, '$store', { value });\r\n        return value;\r\n    }\r\n    regishterModule(module: Record<string, Newable>, options?: ModuleOptions) {\r\n        Object.keys(module).forEach(key => {\r\n            Store.registerModule(key, module[key], this.instance, this.module, options);\r\n        });\r\n    }\r\n}","import { DESIGN_TYPE } from './constants';\r\nimport { Newable } from './type';\r\n\r\nexport interface ModuleOptions {\r\n    /**\r\n     * Create a reusable module\r\n     * @default false\r\n     */\r\n    reusable?: boolean;\r\n    /**\r\n     * Module type, if the emitDecoratorMetadata option is enabled, then it is optional\r\n     */\r\n    type?: Newable;\r\n}\r\n\r\nconst MODULE_KEYS = Symbol();\r\n\r\nexport function Module(options?: ModuleOptions) {\r\n    return function (target: any, name: string) {\r\n        const modules = Reflect.getMetadata(MODULE_KEYS, target) || [];\r\n        const propertyType = Reflect.getMetadata(DESIGN_TYPE, target, name);\r\n        console.log(propertyType);\r\n        modules.push({ name, type: propertyType, options });\r\n        Reflect.defineMetadata(MODULE_KEYS, modules, target);\r\n    }\r\n}\r\n\r\nModule.hasModule = function (target: any) {\r\n    return Reflect.hasMetadata(MODULE_KEYS, target);\r\n}\r\n\r\nModule.getModules = function (target: any): { name: string, type: any, options?: ModuleOptions }[] {\r\n    return Reflect.getMetadata(MODULE_KEYS, target);\r\n}","import { Store as S, Module as M } from 'vuex'\r\nimport { Module, ModuleOptions } from './module';\r\nimport { Newable } from './type';\r\n\r\nfunction getState(store: S<any>, module: string[]) {\r\n    let state = store.state;\r\n    for (let index = 0; module && index < module.length; index++) {\r\n        const element = module[index];\r\n        state = state[element];\r\n        if (state === undefined) return;\r\n    }\r\n    return state;\r\n}\r\n\r\nexport class Store {\r\n    static createStore(instance: { $store: S<any>, $root: any } & Record<string, any>, name: string[] = [], namespaced = false, reusable = false) {\r\n        const prototype = Object.getPrototypeOf(instance);\r\n        const store: M<any, any> = { namespaced, mutations: {}, getters: {}, actions: {}, modules: {} };\r\n        // compute state\r\n        const state = store.state = Object.keys(instance).reduce((result, key) => {\r\n            result[key] = instance[key];\r\n            Object.defineProperty(instance, key, {\r\n                get: () => getState(instance.$store, name)[key],\r\n                set: (value) => getState(instance.$store, name)[key] = value\r\n            })\r\n            return result;\r\n        }, {} as Record<string, any>);\r\n        // compute mutations(setters) getters and actions(methods)\r\n        Object.getOwnPropertyNames(prototype).reduce((result, key) => {\r\n            const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\r\n            if (key === 'constructor' || !descriptor) return result;\r\n            const methods = ['get', 'set', 'value'] as const;\r\n            methods.filter(method => descriptor.configurable && typeof descriptor[method] === 'function').forEach((method) => {\r\n                const original = descriptor[method];\r\n                const path = namespaced ? [...name, key].join('/') : key;\r\n                if (method === 'set') {\r\n                    descriptor.set = v => instance.$store.commit(path, v);\r\n                    result.mutations![key] = (s, value) => original.call(s, value);\r\n                }\r\n                if (method === 'get') {\r\n                    result.getters![key] = original.bind(instance);\r\n                    descriptor.get = () => instance.$store.getters[path];\r\n                }\r\n                if (method === 'value') {\r\n                    descriptor.value = (payload: any) => instance.$store.dispatch(path, payload);\r\n                    result.actions![key] = (_context, payload) => original.call(instance, payload);\r\n                }\r\n            })\r\n            Object.defineProperty(prototype, key, descriptor);\r\n            return result;\r\n        }, store);\r\n        reusable && (store.state = () => state);\r\n        // compute modules\r\n        if (Module.hasModule(prototype)) {\r\n            Module.getModules(prototype).forEach(module => {\r\n                Store.registerModule(module.name, module.type, instance, store, module.options);\r\n            })\r\n        }\r\n        return store;\r\n    }\r\n\r\n    static registerModule(name: string, type: Newable, parent: any, store: M<any, any>, options?: ModuleOptions) {\r\n        const prototype = Object.getPrototypeOf(parent);\r\n        const childInstance = Store.construct(type);\r\n        Object.defineProperty(prototype, name, { get: () => childInstance });\r\n        Object.defineProperty(childInstance, '$root', { get: () => parent.$root || parent });\r\n        Object.defineProperty(childInstance, '$store', { get: () => parent.$store });\r\n        const reusable = options?.reusable;\r\n        const module = Store.createStore(childInstance, [name], true, reusable);\r\n        store.modules![name] = module;\r\n    }\r\n\r\n    static construct(cls: Newable) {\r\n        console.log(cls);\r\n        return new cls();\r\n    }\r\n}\r\n\r\n","module.exports = require(\"reflect-metadata\");;","module.exports = require(\"vuex\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(607);\n"],"sourceRoot":""}